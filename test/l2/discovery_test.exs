# Copyright Â© 2016 Jonathan Storm <the.jonathan.storm@gmail.com>
# This work is free. You can redistribute it and/or modify it under the
# terms of the Do What The Fuck You Want To Public License, Version 2,
# as published by Sam Hocevar. See the COPYING.WTFPL file for more details.

defmodule Giraphe.L2.DiscoveryTest do
  use ExUnit.Case
  doctest Giraphe.L2.Discovery

  import Giraphe.L2.Discovery

  test "Returns list of switches" do
    expected_switches =
      [ %Giraphe.Switch{name: "192.0.2.3", polladdr: "192.0.2.3", physaddr: "00:00:00:00:00:03", uplink: "Gi1/24",
          fdb: [
            {"Gi1/24", "00:00:00:00:00:01"},
            {"Gi1/1",  "00:00:00:00:00:07"},
            {"Gi1/1",  "00:00:00:00:00:10"},
            {"Gi1/1",  "00:00:00:00:00:20"},
            {"Gi1/1",  "00:00:00:00:00:30"},
            {"Gi1/1",  "00:00:00:00:00:40"},
            {"Gi1/1",  "00:00:00:00:00:50"},
            {"Gi1/1",  "00:00:00:00:00:51"},
            {"Gi1/1",  "00:00:00:00:00:52"},
            {"Gi1/1",  "00:00:00:00:00:53"},
            {"Gi1/1",  "00:00:00:00:00:54"},
            {"Gi1/1",  "00:00:00:00:00:55"},
            {"Gi1/1",  "00:00:00:00:00:56"},
            {"Gi1/1",  "00:00:00:00:00:57"},
            {"Gi1/1",  "00:00:00:00:00:58"},
            {"Gi1/1",  "00:00:00:00:00:59"},
            {"Gi1/1",  "00:00:00:00:00:60"},
            {"Gi1/1",  "00:00:00:00:00:70"},
            {"Gi1/1",  "00:00:00:00:00:80"},
            {"Gi1/1",  "00:00:00:00:00:90"},
            {"Gi1/1",  "00:00:00:00:01:00"},
            {"Gi1/1",  "00:00:00:00:01:01"},
            {"Gi1/1",  "00:00:00:00:01:02"},
            {"Gi1/1",  "00:00:00:00:01:03"},
            {"Gi1/1",  "00:00:00:00:01:04"},
            {"Gi1/1",  "00:00:00:00:01:05"},
            {"Gi1/1",  "00:00:00:00:01:06"},
            {"Gi1/1",  "00:00:00:00:01:07"},
            {"Gi1/1",  "00:00:00:00:01:08"},
            {"Gi1/1",  "00:00:00:00:01:09"},
            {"Gi1/1",  "00:00:00:00:01:10"},
            {"Gi1/1",  "00:00:00:00:01:20"},
            {"Gi1/1",  "00:00:00:00:01:30"},
            {"Gi1/1",  "00:00:00:00:01:40"},
            {"Gi1/1",  "00:00:00:00:01:50"},
            {"Gi1/1",  "00:00:00:00:01:60"},
            {"Gi1/1",  "00:00:00:00:01:70"},
            {"Gi1/1",  "00:00:00:00:01:80"},
            {"Gi1/1",  "00:00:00:00:01:90"},
            {"Gi1/1",  "00:00:00:00:02:00"}
          ]
        },
        %Giraphe.Switch{name: "192.0.2.7", polladdr: "192.0.2.7", physaddr: "00:00:00:00:00:07", uplink: "Gi1/24",
          fdb: [
            {"Gi1/24", "00:00:00:00:00:01"},
            {"Gi1/1",  "00:00:00:00:00:10"},
            {"Gi1/2",  "00:00:00:00:00:20"},
            {"Gi1/3",  "00:00:00:00:00:30"},
            {"Gi1/4",  "00:00:00:00:00:40"},
            {"Gi1/5",  "00:00:00:00:00:50"},
            {"Gi1/5",  "00:00:00:00:00:51"},
            {"Gi1/5",  "00:00:00:00:00:52"},
            {"Gi1/5",  "00:00:00:00:00:53"},
            {"Gi1/5",  "00:00:00:00:00:54"},
            {"Gi1/5",  "00:00:00:00:00:55"},
            {"Gi1/5",  "00:00:00:00:00:56"},
            {"Gi1/5",  "00:00:00:00:00:57"},
            {"Gi1/5",  "00:00:00:00:00:58"},
            {"Gi1/5",  "00:00:00:00:00:59"},
            {"Gi1/6",  "00:00:00:00:00:60"},
            {"Gi1/7",  "00:00:00:00:00:70"},
            {"Gi1/8",  "00:00:00:00:00:80"},
            {"Gi1/9",  "00:00:00:00:00:90"},
            {"Gi1/10", "00:00:00:00:01:00"},
            {"Gi1/10", "00:00:00:00:01:01"},
            {"Gi1/10", "00:00:00:00:01:02"},
            {"Gi1/10", "00:00:00:00:01:03"},
            {"Gi1/10", "00:00:00:00:01:04"},
            {"Gi1/10", "00:00:00:00:01:05"},
            {"Gi1/10", "00:00:00:00:01:06"},
            {"Gi1/10", "00:00:00:00:01:07"},
            {"Gi1/10", "00:00:00:00:01:08"},
            {"Gi1/10", "00:00:00:00:01:09"},
            {"Gi1/11", "00:00:00:00:01:10"},
            {"Gi1/12", "00:00:00:00:01:20"},
            {"Gi1/13", "00:00:00:00:01:30"},
            {"Gi1/14", "00:00:00:00:01:40"},
            {"Gi1/15", "00:00:00:00:01:50"},
            {"Gi1/16", "00:00:00:00:01:60"},
            {"Gi1/17", "00:00:00:00:01:70"},
            {"Gi1/18", "00:00:00:00:01:80"},
            {"Gi1/19", "00:00:00:00:01:90"},
            {"Gi1/20", "00:00:00:00:02:00"}
          ]
        },
        %Giraphe.Switch{name: "192.0.2.10", polladdr: "192.0.2.10", physaddr: "00:00:00:00:00:10", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name: "192.0.2.20", polladdr: "192.0.2.20", physaddr: "00:00:00:00:00:20", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name: "192.0.2.30", polladdr: "192.0.2.30", physaddr: "00:00:00:00:00:30", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name: "192.0.2.40", polladdr: "192.0.2.40", physaddr: "00:00:00:00:00:40", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name: "192.0.2.50", polladdr: "192.0.2.50", physaddr: "00:00:00:00:00:50", uplink: "Gi1/24",
          fdb: [
            {"Gi1/24", "00:00:00:00:00:01"},
            {"Gi1/1",  "00:00:00:00:00:51"},
            {"Gi1/2",  "00:00:00:00:00:52"},
            {"Gi1/3",  "00:00:00:00:00:53"},
            {"Gi1/4",  "00:00:00:00:00:54"},
            {"Gi1/5",  "00:00:00:00:00:55"},
            {"Gi1/5",  "00:00:00:00:00:56"},
            {"Gi1/5",  "00:00:00:00:00:57"},
            {"Gi1/5",  "00:00:00:00:00:58"},
            {"Gi1/5",  "00:00:00:00:00:59"}
          ]
        },
        %Giraphe.Switch{name: "192.0.2.51", polladdr: "192.0.2.51", physaddr: "00:00:00:00:00:51", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name: "192.0.2.52", polladdr: "192.0.2.52", physaddr: "00:00:00:00:00:52", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name: "192.0.2.53", polladdr: "192.0.2.53", physaddr: "00:00:00:00:00:53", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name: "192.0.2.54", polladdr: "192.0.2.54", physaddr: "00:00:00:00:00:54", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name: "192.0.2.55", polladdr: "192.0.2.55", physaddr: "00:00:00:00:00:55", uplink: "Gi1/24",
          fdb: [
            {"Gi1/24", "00:00:00:00:00:01"},
            {"Gi1/1",  "00:00:00:00:00:56"},
            {"Gi1/2",  "00:00:00:00:00:57"},
            {"Gi1/3",  "00:00:00:00:00:58"},
            {"Gi1/4",  "00:00:00:00:00:59"}
          ]
        },
        %Giraphe.Switch{name:  "192.0.2.56", polladdr:  "192.0.2.56", physaddr: "00:00:00:00:00:56", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name:  "192.0.2.57", polladdr:  "192.0.2.57", physaddr: "00:00:00:00:00:57", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name:  "192.0.2.58", polladdr:  "192.0.2.58", physaddr: "00:00:00:00:00:58", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name:  "192.0.2.59", polladdr:  "192.0.2.59", physaddr: "00:00:00:00:00:59", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name:  "192.0.2.60", polladdr:  "192.0.2.60", physaddr: "00:00:00:00:00:60", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name:  "192.0.2.70", polladdr:  "192.0.2.70", physaddr: "00:00:00:00:00:70", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name:  "192.0.2.80", polladdr:  "192.0.2.80", physaddr: "00:00:00:00:00:80", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name:  "192.0.2.90", polladdr:  "192.0.2.90", physaddr: "00:00:00:00:00:90", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name: "192.0.2.100", polladdr: "192.0.2.100", physaddr: "00:00:00:00:01:00", uplink: "Gi1/24",
          fdb: [
            {"Gi1/24", "00:00:00:00:00:01"},
            {"Gi1/1",  "00:00:00:00:01:01"},
            {"Gi1/2",  "00:00:00:00:01:02"},
            {"Gi1/3",  "00:00:00:00:01:03"},
            {"Gi1/4",  "00:00:00:00:01:04"},
            {"Gi1/5",  "00:00:00:00:01:05"},
            {"Gi1/6",  "00:00:00:00:01:06"},
            {"Gi1/7",  "00:00:00:00:01:07"},
            {"Gi1/8",  "00:00:00:00:01:08"},
            {"Gi1/9",  "00:00:00:00:01:09"}
          ]
        },
        %Giraphe.Switch{name: "192.0.2.101", polladdr: "192.0.2.101", physaddr: "00:00:00:00:01:01", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name: "192.0.2.102", polladdr: "192.0.2.102", physaddr: "00:00:00:00:01:02", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name: "192.0.2.103", polladdr: "192.0.2.103", physaddr: "00:00:00:00:01:03", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name: "192.0.2.104", polladdr: "192.0.2.104", physaddr: "00:00:00:00:01:04", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name: "192.0.2.105", polladdr: "192.0.2.105", physaddr: "00:00:00:00:01:05", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name: "192.0.2.106", polladdr: "192.0.2.106", physaddr: "00:00:00:00:01:06", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name: "192.0.2.107", polladdr: "192.0.2.107", physaddr: "00:00:00:00:01:07", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name: "192.0.2.108", polladdr: "192.0.2.108", physaddr: "00:00:00:00:01:08", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name: "192.0.2.109", polladdr: "192.0.2.109", physaddr: "00:00:00:00:01:09", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name: "192.0.2.110", polladdr: "192.0.2.110", physaddr: "00:00:00:00:01:10", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name: "192.0.2.120", polladdr: "192.0.2.120", physaddr: "00:00:00:00:01:20", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name: "192.0.2.130", polladdr: "192.0.2.130", physaddr: "00:00:00:00:01:30", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name: "192.0.2.140", polladdr: "192.0.2.140", physaddr: "00:00:00:00:01:40", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name: "192.0.2.150", polladdr: "192.0.2.150", physaddr: "00:00:00:00:01:50", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name: "192.0.2.160", polladdr: "192.0.2.160", physaddr: "00:00:00:00:01:60", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name: "192.0.2.170", polladdr: "192.0.2.170", physaddr: "00:00:00:00:01:70", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name: "192.0.2.180", polladdr: "192.0.2.180", physaddr: "00:00:00:00:01:80", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name: "192.0.2.190", polladdr: "192.0.2.190", physaddr: "00:00:00:00:01:90", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]},
        %Giraphe.Switch{name: "192.0.2.200", polladdr: "192.0.2.200", physaddr: "00:00:00:00:02:00", uplink: "Gi1/24", fdb: [{"Gi1/24", "00:00:00:00:00:01"}]}
      ]

    switches = discover "192.0.2.1"

    assert switches == expected_switches
  end
end
